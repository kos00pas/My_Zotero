#
# # Base storage directory for PDFs
# base_storage_dir = r"C:\Users\kos00\OneDrive - University of Cyprus\Zeroto_Drive\storage"
#
# # Path to Zotero SQLite database
# db_path = r"C:\Users\kos00\OneDrive - University of Cyprus\Zeroto_Drive\zoteroCopy.sqlite"
#
# def find_pdf_in_storage(file_name):
#     """Search for the given file name in all subdirectories of the storage directory."""
#     for root, _, files in os.walk(base_storage_dir):
#         if file_name in files:
#             return os.path.join(root, file_name)
#     print("\t\tNONE NONE NONE\t")
#     return None
#
# try:
#     conn = sqlite3.connect(f"file:{db_path}?mode=ro", uri=True)
#     cursor = conn.cursor()
#
#     print("Zotero Library Structure:")
#
#     # List to track directories with no PDFs
#     directories_without_pdfs = []
#
#     # Fetch collections
#     cursor.execute("SELECT collectionName, collectionID FROM collections")
#     collections = cursor.fetchall()
#
#     for collection in collections:
#         print(f"Folder: {collection[0]} ... includes: " )
#         pdf_found = False  # Track if PDFs are found in this directory
#
#         # Fetch items within the collection
#         cursor.execute("""
#             SELECT items.itemID, itemDataValues.value
#             FROM items
#             JOIN collectionItems ON items.itemID = collectionItems.itemID
#             JOIN itemData ON items.itemID = itemData.itemID
#             JOIN itemDataValues ON itemData.valueID = itemDataValues.valueID
#             WHERE collectionItems.collectionID = ?
#               AND itemData.fieldID = (SELECT fieldID FROM fields WHERE fieldName = 'title')
#         """, (collection[1],))
#         items = cursor.fetchall()
#
#         for item_id, title in items:
#             print(f"  - {title}")
#
#             # Fetch PDF attachments for each item
#             cursor.execute("""
#                 SELECT itemAttachments.path
#                 FROM itemAttachments
#                 WHERE itemAttachments.parentItemID = ?
#                   AND itemAttachments.path IS NOT NULL
#             """, (item_id,))
#             attachments = cursor.fetchall()
#
#             for attachment in attachments:
#                 relative_path = attachment[0].replace("storage:", "").replace("\\", "")
#                 if relative_path.endswith(".pdf"):
#                     file_path = find_pdf_in_storage(relative_path)
#                     if file_path:
#                         print(f"\t    PDF: '{file_path}'")
#                         pdf_found = True
#                         # Replace base_target_dir with target_dir
#                         copy_pdf_to_target(file_path, target_dir, collection[0])
#
#                     else:
#                         print(f"[WARNING] PDF not found: {relative_path}")
#                         # Attempt to find the file in base_storage_dir
#                         actual_location = find_pdf_in_storage(relative_path.split('/')[-1])
#                         if actual_location:
#                             print(f"\t[INFO] Found actual location: {actual_location}")
#                         else:
#                             print(f"\t[ERROR] Unable to locate PDF: {relative_path}")
#
#         # If no PDFs were found for the collection, add it to the list
#         if not pdf_found:
#             directories_without_pdfs.append(collection[0])
#
#     conn.close()
#
#
#
# except Exception as e:
#     print(f"Error: {e}")